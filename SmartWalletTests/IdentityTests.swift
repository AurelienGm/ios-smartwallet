//
//  IdentityTests.swift
//  WalletSdkTests
//
//  Created by Frederic DE MATOS on 21/02/2020.
//  Copyright Â© 2020 Rockside. All rights reserved.
//

import Foundation



import XCTest
import BigInt
import web3

@testable import Moonkey

class IdentityTests: XCTestCase {
    
    let mnemonic = "refuse pair extra viable drum account stand crazy domain holiday trend floor"
    let identityAddress = EthereumAddress(string: "0xeab90b8ebb9c05D3f288639d7E77eF415Ff5Febc")

    func testSignMessage() {
        let expectedSignature = "0x2957ea067f706d1edd9b3211fbd3924fe3eb081d3737de8454fae3cc092224f306b22abf2ffd07acf7269f2c0f03a42ba60b4c6ad928ccd0e0d60cd3720a8b4e01"
              
        let identity = Identity(mnemonic:mnemonic, address: self.identityAddress!)
        
        let signature = identity.signTx(data: "", nonce: 0)
        XCTAssertEqual(signature, expectedSignature)
    }
    
    func testEncodeUpdateOwners() {
        let identity = Identity(mnemonic:mnemonic, address: self.identityAddress!)
        
        let messageData = identity.encodeUpdateWhiteList(eoa: "0xf845b2501A69eF480aC577b99e96796c2B6AE88E", value: true)
        XCTAssertEqual(messageData, "0x40b7e576000000000000000000000000f845b2501a69ef480ac577b99e96796c2b6ae88e0000000000000000000000000000000000000000000000000000000000000001")
    }
    
    func testEncodeExecuteWithData() {
        
        let identity = Identity(mnemonic:mnemonic, address: self.identityAddress!)
        
        let data = Data(hexString: "0xa9059cbb000000000000000000000000f845b2501a69ef480ac577b99e96796c2b6ae88e00000000000000000000000000000000000000000000000010a741a462780000")!
        let messageData = identity.encodeExecute(to: "0x6b175474e89094c44da98b954eedeac495271d0f", value: BigUInt(0), data: data)
        XCTAssertEqual(messageData, "0xb61d27f60000000000000000000000006b175474e89094c44da98b954eedeac495271d0f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044a9059cbb000000000000000000000000f845b2501a69ef480ac577b99e96796c2b6ae88e00000000000000000000000000000000000000000000000010a741a46278000000000000000000000000000000000000000000000000000000000000")
    }
    
    
    func testEncodeBatchData() {
        
        let identity = Identity(mnemonic:mnemonic, address: self.identityAddress!)
        
        let to = "0x89D3478550a82efa26ee0B4Aab7025b5Ef154fa7"
        let value = 0
        
        let data1 = Data(hexString: "0x52a438b800000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001")!
        
        let data2 = Data(hexString: "0x52a438b800000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000002")!
        
        let messageData = identity.encodeBatch(to: to, value: BigUInt(0), data: data2)
        XCTAssertEqual(messageData, "0xb780c36200000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000089d3478550a82efa26ee0b4aab7025b5ef154fa700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000004452a438b80000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000")
    }

}
